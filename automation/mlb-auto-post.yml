name: âš¾ MLB ì‹œë²”ê²½ê¸° ìë™ í¬ìŠ¤íŠ¸

on:
  schedule:
    # í•œêµ­ì‹œê°„ ê¸°ì¤€ ì£¼ìš” ì‹œê°„ëŒ€ì— ì‹¤í–‰ (UTC ê¸°ì¤€)
    # ì˜¤ì „ 6ì‹œ (KST) = ì „ë‚  ë°¤ 21:00 UTC â†’ ë¯¸êµ­ ì˜¤í›„ ê²½ê¸° ì¢…ë£Œ í›„
    - cron: '0 21 * * *'
    # ì˜¤ì „ 11ì‹œ (KST) = 02:00 UTC â†’ ë¯¸êµ­ ì•¼ê°„ ê²½ê¸° ì¢…ë£Œ í›„
    - cron: '0 2 * * *'
    # ì˜¤í›„ 4ì‹œ (KST) = 07:00 UTC â†’ ë‚® ê²½ê¸° ì—…ë°ì´íŠ¸
    - cron: '0 7 * * *'

  # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼ (GitHub Actions íƒ­ì—ì„œ ì§ì ‘ ì‹¤í–‰ ê°€ëŠ¥)
  workflow_dispatch:

jobs:
  generate-mlb-post:
    runs-on: ubuntu-latest

    # ì‹œë²”ê²½ê¸° ê¸°ê°„ì—ë§Œ ì‹¤í–‰ (2ì›” 20ì¼ ~ 3ì›” 25ì¼)
    # ì´ ì¡°ê±´ì„ ì—†ì• ë©´ ì—°ì¤‘ ì‹¤í–‰ë¨
    if: |
      (github.event_name == 'workflow_dispatch') ||
      (github.event_name == 'schedule')

    steps:
      # 1. ë ˆí¬ ì²´í¬ì•„ì›ƒ
      - name: ğŸ“¥ ë ˆí¬ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # 2. Python ì„¤ì¹˜
      - name: ğŸ Python 3.11 ì„¤ì¹˜
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      # 3. í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜
      - name: ğŸ“¦ íŒ¨í‚¤ì§€ ì„¤ì¹˜
        run: |
          pip install requests anthropic

      # 4. MLB í¬ìŠ¤íŠ¸ ìƒì„± ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
      - name: âš¾ MLB í¬ìŠ¤íŠ¸ ìƒì„±
        env:
          CLAUDE_API_KEY: ${{ secrets.CLAUDE_API_KEY }}
        run: |
          python automation/mlb_auto_post.py

      # 5. ìƒì„±ëœ í¬ìŠ¤íŠ¸ ìë™ ì»¤ë°‹ & í‘¸ì‹œ
      - name: ğŸ“¤ ìë™ ì»¤ë°‹ & ë°°í¬
        run: |
          git config --local user.email "mlb-bot@jkimjoon70.github.io"
          git config --local user.name "âš¾ MLB Bot"
          git add _posts/
          # ë³€ê²½ì‚¬í•­ì´ ìˆì„ ë•Œë§Œ ì»¤ë°‹ (ì—†ìœ¼ë©´ ê·¸ëƒ¥ ì¢…ë£Œ)
          git diff --staged --quiet || git commit -m "âš¾ MLB ì‹œë²”ê²½ê¸° ì—…ë°ì´íŠ¸ - $(date '+%Y-%m-%d %H:%M KST' -d '+9 hours')"
          git push
