name: âš¾ MLB ì‹œë²”ê²½ê¸° ìë™ í¬ìŠ¤íŠ¸

on:
  schedule:
    # í•œêµ­ì‹œê°„ ê¸°ì¤€ ì£¼ìš” ì‹œê°„ëŒ€ ì‹¤í–‰
    # ì˜¤ì „ 6ì‹œ KST â†’ ë¯¸êµ­ ê²½ê¸° ì¢…ë£Œ í›„
    - cron: '0 21 * * *'
    # ì˜¤ì „ 11ì‹œ KST â†’ ì•¼ê°„ ê²½ê¸° ì¢…ë£Œ í›„
    - cron: '0 2 * * *'
    # ì˜¤í›„ 4ì‹œ KST â†’ ë‚® ê²½ê¸° ì—…ë°ì´íŠ¸
    - cron: '0 7 * * *'

  # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼
  workflow_dispatch:

jobs:
  generate-mlb-post:
    runs-on: ubuntu-latest

    steps:
      # 1ï¸âƒ£ ë ˆí¬ ì²´í¬ì•„ì›ƒ
      - name: ğŸ“¥ ë ˆí¬ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # 2ï¸âƒ£ Python ì„¤ì¹˜
      - name: ğŸ Python 3.11 ì„¤ì¹˜
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      # 3ï¸âƒ£ íŒ¨í‚¤ì§€ ì„¤ì¹˜
      - name: ğŸ“¦ íŒ¨í‚¤ì§€ ì„¤ì¹˜
        run: |
          pip install requests anthropic

      # 4ï¸âƒ£ MLB í¬ìŠ¤íŠ¸ ìƒì„±
      - name: âš¾ MLB í¬ìŠ¤íŠ¸ ìƒì„±
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
        run: |
          python automation/mlb_auto_post.py

      # 5ï¸âƒ£ ìë™ ì»¤ë°‹ & í‘¸ì‹œ
      - name: ğŸ“¤ ìë™ ì»¤ë°‹ & ë°°í¬
        run: |
          git config --local user.email "mlb-bot@jkimjoon70.github.io"
          git config --local user.name "âš¾ MLB Bot"
          git add _posts/
          git diff --staged --quiet || git commit -m "âš¾ MLB ì‹œë²”ê²½ê¸° ì—…ë°ì´íŠ¸ - $(date '+%Y-%m-%d %H:%M KST' -d '+9 hours')"
          git push
